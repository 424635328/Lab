# **实验指导手册：从数据采集到模型部署的全流程操作**

本手册是为“人工智能教学实验箱：数字积木排序”项目量身定制的实战指南。它将引导您和您的团队成员，将分散的技术操作融入到一个连贯的、端到端的AI项目工作流中。

## **工作流概览**

我们的项目将遵循一个标准的AI开发流程，主要分为三个物理地点和三个逻辑阶段：

| **物理地点** | **核心任务**                                | **主要阶段**             | **关键产出**                                       |
| :----------- | :------------------------------------------ | :----------------------- | :------------------------------------------------- |
| **实验箱**   | 使用摄像头采集原始图像数据                  | **Phase 1: 数据采集**    | 一个包含数千张分类图像的 `digital_dataset` 文件夹  |
| **PC**       | 清洗数据、训练模型、优化模型                | **Phase 2: 模型训练**    | 一个轻量化的、可在实验箱上运行的模型文件 `lenet.nb` |
| **实验箱**   | 部署模型，开发人机交互界面，控制机械臂      | **Phase 3: 应用部署**    | 一个可以完成自动排序搬运任务的可执行应用程序       |

---

## **Phase 1: 数据采集 (地点：实验箱)**

**目标**: 创建一个高质量、多样化的、用于训练我们自己模型的原始图像数据集。

### **步骤 1.1: 部署采集脚本**

这是连接PC与实验箱的第一步。我们需要将用于采集数据的Python脚本从PC发送到实验箱。

1.  **核对信息**: 在开始前，请在团队内部分享并确认以下信息：
    *   PC上 `collect_data.py` 的存放路径。
    *   实验箱的IP地址、用户名(`linux`)和密码(`1`)。

2.  **执行SCP传输 (在PC终端)**:
    *   打开PC终端，`cd`到`collect_data.py`所在的目录。
    *   执行以下命令，将脚本传输到实验箱的桌面。**请务必将IP地址替换为你们的实际IP。**
        ```bash
        # 示例命令，将IP替换为实际值
        scp ./collect_data.py linux@192.168.1.101:~/Desktop/
        ```
    *   按提示输入密码`1`并回车。

3.  **验证**: 前往实验箱，确认桌面上已出现`collect_data.py`文件。

### **步骤 1.2: 执行数据采集**

**团队配合**:
*   **操作员 (1名)**: 负责在实验箱上运行脚本和按键保存。
*   **物料员 (1-2名)**: 负责摆放积木，并根据口头指令创造多样化的拍摄条件。

**操作流程**:

1.  **启动脚本 (操作员)**:
    *   在实验箱上打开终端 (`Ctrl + Alt + T`)。
    *   进入桌面目录: `cd ~/Desktop/`
    *   运行脚本: `python3 collect_data.py`
    *   一个实时视频窗口将会弹出。

2.  **进行系统化采集 (全员配合)**:
    *   **物料员**: 拿起**第一个数字积木**（例如“8”号）。
    *   **物料员**: 将“8”号积木放在“仓库一”的左上角格子中央，正对摄像头。
    *   **操作员**: 确认画面清晰后，按下键盘上的 **`8`** 键。终端会显示“保存成功”。
    *   **物料员**: 遵循环绕以下“多样性检查清单”改变条件，每改变一次，操作员就按一次 **`8`** 键：
        *   **[✓] 光照变化**: 用手在积木上方制造阴影；用手机手电筒从侧面补光。
        *   **[✓] 位置变化**: 将积木移动到格子的四个角落和边缘。
        *   **[✓] 角度变化**: 将积木稍微向左/右/前/后倾斜。
        *   **[✓] 格子变化**: 将积木放到“仓库一”的其他三个格子里重复上述操作。
    *   **循环**: 对**每一个数字积木 (0-9)** 都完整地执行一遍上述系统化采集流程。**建议每个数字采集50-100张图片。**
        > **团队协作提示**: 物料员可以喊出“8号，左上角，有阴影，准备好！”，操作员听到后按键。这样可以高效协作。

3.  **结束采集 (操作员)**:
    *   当所有数字都采集完毕后，按下键盘上的 **`q`** 键。
    *   程序将自动关闭摄像头和窗口。
    *   此时，实验箱桌面上会出现一个名为 `digital_dataset` 的文件夹，里面包含了你们团队的劳动成果。

---

## **Phase 2: 模型训练 (地点：PC)**

**目标**: 利用采集到的数据，在算力更强的PC上训练出高性能的AI模型，并将其转换为适合实验箱的轻量级格式。

### **步骤 2.1: 将数据集从实验箱回传到PC**

现在，我们需要将“原材料”——图像数据集，从实验箱运回PC的“加工厂”。

1.  **执行反向SCP (在PC终端)**:
    *   打开PC终端，`cd`到您的项目主目录 (例如 `~/ai_arm_project/`)。
    *   执行以下命令。注意这次是把**远程的文件夹**(`-r`代表递归)下载到**本地**。
        ```bash
        # 将实验箱桌面上的整个 digital_dataset 文件夹下载到PC当前目录下
        scp -r linux@192.168.1.101:~/Desktop/digital_dataset ./
        ```
    *   按提示输入密码`1`并回车。

2.  **验证**: 在PC的项目目录下，使用`ls`命令，确认`digital_dataset`文件夹已成功下载。

### **步骤 2.2: 数据划分、模型训练与转换 (在PC终端)**

这一系列操作都在PC上完成，利用PC的强大计算能力。

1.  **数据划分**:
    ```bash
    # 确保您在PC项目的虚拟环境中 (source venv/bin/activate)
    # 运行划分脚本
    python3 split_dataset.py
    ```
    > **产出**: 一个新的 `data_split` 文件夹，内含 `train`, `val`, `test` 子目录。

2.  **模型训练**:
    ```bash
    # 运行训练脚本
    python3 train.py
    ```
    > **产出**: 一个新的 `inference_model` 文件夹，内含 `.pdmodel` 和 `.pdiparams` 文件。

3.  **模型转换**:
    ```bash
    # 运行 opt 工具进行转换
    opt --model_file=./inference_model/lenet.pdmodel \
        --param_file=./inference_model/lenet.pdiparams \
        --optimize_out_type=naive_buffer \
        --optimize_out=./lite_model \
        --valid_targets=arm
    ```
    > **关键产出**: 一个新的 `lite_model` 文件夹，其中包含我们最终需要的 **`lenet.nb`** 文件。

---

## **Phase 3: 应用部署 (地点：实验箱)**

**目标**: 将训练好的模型部署到实验箱，并集成到我们开发的Qt应用程序中，实现最终的功能。

### **步骤 3.1: 将最终模型部署到实验箱**

我们需要将轻量化的 `lenet.nb` 模型文件，从PC发送到实验箱上我们即将开发的Qt项目文件夹中。

1.  **在实验箱上创建Qt项目**:
    *   打开实验箱上的Qt Creator。
    *   新建一个Qt Widgets Application，命名为 `ArmSortApp`，并保存在您希望的位置（例如 `~/ArmSortApp`）。

2.  **执行SCP传输 (在PC终端)**:
    *   `cd` 到PC上的 `~/ai_arm_project/lite_model/` 目录。
    *   执行以下命令，将模型文件直接发送到刚刚创建的Qt项目文件夹中。
        ```bash
        # 将 lenet.nb 文件发送到实验箱的 ArmSortApp 项目文件夹
        scp ./lenet.nb linux@192.168.1.101:~/ArmSortApp/
        ```
    *   按提示输入密码`1`并回车。

### **步骤 3.2: 开发并运行Qt应用程序**

现在，所有的准备工作都已完成。请按照之前提供的手册内容，在**实验箱的Qt Creator**中，完成以下工作：

1.  **配置 `.pro` 文件**: 引入OpenCV和PaddleLite库。
2.  **设计 UI 界面**: 拖拽控件并命名。
3.  **编写 `mainwindow.h` 和 `mainwindow.cpp`**: 将提供的代码复制粘贴进去。
4.  **关键标定 (重要！)**:
    *   **ROI标定**: 运行一次程序，根据视频画面，**反复修改 `mainwindow.cpp` 中 `warehouse1_rois` 的坐标**，直到绿色框完美匹配仓库格子。
    *   **串口配置**: 在 `mainwindow.cpp` 中，**确认或修改串口设备名** (`/dev/ttyS1`)。
5.  **编译和运行**: 点击Qt Creator的运行按钮。
6.  **最终测试**: 在实验箱上摆好积木，点击程序界面上的“开始排序”按钮，观察并记录实验结果。